name: Test Unhide Revealed Comment Action

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  test_action:
    name: Test Unhide Revealed Comment Action

    runs-on: [self-hosted, org]
    permissions:
      pull-requests: write
      issues: write
      contents: write
      checks: write
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Comment on PR with direct comment
        uses: ./
        id: comment-direct
        with:
          comment-id: "test-resolution-reopen-again"
          comment-body: "test resolution reopen - initial comment"
          conclusion: "failure"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          update-mode: "append"

      - name: Update comment with append (and hide)
        uses: ./
        id: comment-update-append-hide
        with:
          comment-id: "test-resolution-reopen-again"
          comment-body: "test resolution reopen - updated comment"
          conclusion: "success"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          update-mode: "append"
          on-resolution-hide: true

      - name: Update comment with append (and reopen)
        uses: ./
        id: comment-update-append-unhide
        with:
          comment-id: "test-resolution-reopen-again"
          comment-body: "test resolution reopen - updated comment to reopen"
          conclusion: "failure"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          update-mode: "append"
          on-resolution-hide: true

      - name: Update comment with append (and reopen again)
        uses: ./
        id: comment-update-append-unhide-again
        with:
          comment-id: "test-resolution-reopen-again"
          comment-body: "test resolution reopen - updated comment to reopen again"
          conclusion: "failure"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          update-mode: "append"
          on-resolution-hide: true
